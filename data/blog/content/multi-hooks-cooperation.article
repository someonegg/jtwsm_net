多HOOK协作逻辑
13:00 2 Nov 2013
Tags: HOOK

某某人

* 

多个hook会组成一个链表结构：

hook_1(current) --> hook_2 --> ... --> origin

Unload时：

- 判断current是不是我们，是可以安全卸载，如果不是
- 置上延迟卸载标志，当我们的hook过程收到消息时，尝试Unload（转1）

如果大家都按这个逻辑来，是安全的

如果其它人比较暴力，它们会有3种选择：

- 不还原，直接卸载模块
- 强行还原成自己后面的一个，再卸载
- 还原成explorer最原始的（当然需要通过其它途径找到）

- 选择3，不会导致explorer崩溃，只是我们不再收到消息，所以我们的模块不能卸载
- 选择2，如果它在我们的后面，情形和a一样我们不被卸载；如果在我们前面能正常卸载
- 选择1，比较的可能就是崩溃

当然，多个hook每个人的选择不一样，合在一起情形更复杂。

